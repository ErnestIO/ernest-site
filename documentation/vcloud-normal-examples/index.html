<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>vCloud Normal Examples  &middot; ernest.io</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">


<meta property="og:title" content="vCloud Normal Examples  &middot; ernest.io ">
<meta property="og:site_name" content="ernest.io"/>
<meta property="og:url" content="/documentation/vcloud-normal-examples/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2016-06-06T00:00:00Z" />
<meta property="og:article:modified_time" content="2016-06-06T00:00:00Z" />

  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@r3labs" />
<meta name="twitter:creator" content="@r3labs" />
<meta name="twitter:title" content="vCloud Normal Examples" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/documentation/vcloud-normal-examples/" />
<meta name="twitter:domain" content="/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "vCloud Normal Examples",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-06-06",
    "description": "",
    "wordCount":  1357 
  }
</script>



<link rel="canonical" href="/documentation/vcloud-normal-examples/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/ernest-dog.ico">
<link rel="icon" href="/img/ernest-dog.ico">
<meta name="generator" content="Hugo 0.17-DEV" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/ernest/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">


  <link rel="stylesheet" href="/css/highlight/solarized_dark.css">


  <script src="https://use.fontawesome.com/2abc4da92a.js"></script>
</head>
<body class="map[name:ernest]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    
<header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header navbar-left">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/">
          <img src="/img/dog-round.png" alt="Ernest logo">
          ernest
        </a>
      </div>
      <div id="navbar" class="collapse navbar-collapse navbar-right">
        
        <ul class="nav navbar-nav navbar-right">
        
        
          <li class="">          
            <a href="/documentation"
            >
            
            DOCUMENTATION
            </a>
          </li>
          
        
          <li class="">          
            <a href="/download"
            >
            
            DOWNLOAD
            </a>
          </li>
          
        
          <li class="">          
            <a href="/community"
            >
            
            COMMUNITY
            </a>
          </li>
          
        
          <li class="">          
            <a href="/support"
            >
            
            SUPPORT
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>
</header>


<div class="container">
  <div class="row">
    <div class="left-nav-con col-md-3 hidden-xs hidden-sm">
      <ul class="sub-menu list-unstyled">
  
  

	<li class="main-menu-item">

    
    <span class="main-menu-item-title">Introduction</span>
    


    
    
    
    <ul class="list-unstyled">
    
    
    <li class="">
      <a href="/documentation/">Overview </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/quickstart/">Quickstart </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/cli-guide/">CLI Guide </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/cli-cmds/">CLI Command Reference </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/salt-boot/">Bootstrapping with Salt </a>

      
   		
   		

      </li>
      
      
    </ul>
    

  </li>
  

	<li class="main-menu-item">

    
    <span class="main-menu-item-title">Amazon Web Services</span>
    


    
    
    
    <ul class="list-unstyled">
    
    
    <li class="">
      <a href="/documentation/aws-intro/">Introduction </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/aws-examples/">AWS Examples </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/aws-yaml/">AWS YAML Reference </a>

      
   		
   		

      </li>
      
      
    </ul>
    

  </li>
  

	<li class="main-menu-item active">

    
    <span class="main-menu-item-title">vCloud Director</span>
    


    
    
    
    <ul class="list-unstyled">
    
    
    <li class="">
      <a href="/documentation/vcloud-intro/">Introduction </a>

      
   		
   		

      </li>
      
      
    
    <li class="active">
      <a href="/documentation/vcloud-normal-examples/">vCloud Normal Examples </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/vcloud-enhanced-examples/">vCloud Enhanced Examples </a>

      
   		
   		

      </li>
      
      
    
    <li class="">
      <a href="/documentation/vcloud-yaml/">vCloud YAML Reference </a>

      
   		
   		

      </li>
      
      
    </ul>
    

  </li>
  
</ul>

    </div>
    <div class="content col-md-9">
      

<h1 id="vcloud-director-normal-examples">vCloud Director Normal Examples</h1>

<p>If you would like to try Ernest but do not have access to vCloud you can request a demo vCloud account <a href="/vcloud-account">here</a>.</p>

<p>Before we get started we will need the following information:</p>

<ul>
<li>Ernest IP address (31.210.241.221)</li>
<li>Ernest username/password (user1/xxxxxx)</li>
<li>vCloud URL (myvdc.carrenza.net)</li>
<li>vCloud organisation (r3labs-development)</li>
<li>vCloud datacenter (r3-jreid2)</li>
<li>vCloud network (DVS-VCD-EXT-665)</li>
<li>vCloud username/password (jreid/xxxxxx)</li>
<li>vCloud router name (test1)</li>
<li>vCloud sub-allocated IP (195.3.186.42)</li>
</ul>

<p><em>The values in brackets are what we will use for this example. Your service provider can provide you with the vCloud information.</em></p>

<p>The first step is to set the IP address of Ernest:</p>

<pre><code>$ ernest target https://31.210.241.221
Target set

</code></pre>

<p>Next we login to Ernest:</p>

<pre><code>$ ernest login
Username: user1
Password: ******
Log in succesful.

</code></pre>

<p>Once we have logged in to Ernest we can setup the vCloud datacenter and credentials that Ernest will use to create our infrastructure:</p>

<pre><code>$ ernest datacenter create vcloud --datacenter-user jreid --datacenter-password xxxxxx --datacenter-org r3labs-development r3-jreid2 https://myvdc.carrenza.net DVS-VCD-EXT-665
SUCCESS: Datacenter r3-jreid2 created

</code></pre>

<p>Now that we have our datacenter created in Ernest we can start building stuff. Below we will show examples for:</p>

<ul>
<li>creating infrastructure only</li>
<li>creating infrastructure and configuring the servers</li>
<li>creating the servers only</li>
</ul>

<h3 id="infrastructure-only">Infrastructure Only</h3>

<p>For our example we will deploy a single Ubuntu server from a catalog image (image: r3/ubuntu-1404) and configure our networking to permit SSH access to the server. Our YAML for this example is:</p>

<pre><code>---
name: demo1
datacenter: r3-jreid2
bootstrapping: none
service_ip: 195.3.186.42

routers: 
  - name: test1
    rules:
    - name: in_out_any
      source: internal
      from_port: any
      destination: external
      to_port: any
      protocol: any
      action: allow

    - name: out_in_22
      source: any
      from_port: any
      destination: internal
      to_port: '22'
      protocol: tcp
      action: allow

    networks:
      - name: web
        subnet: 10.1.0.0/24
        dns:
          - 8.8.8.8
          - 8.8.4.4

    port_forwarding:
      - source: 195.3.186.42
        from_port: '22'
        to_port: '22'
        destination: 10.1.0.11

instances:
  - name: web
    image: r3/ubuntu-1404
    cpus: 1
    memory: 1GB
    count: 1
    networks:
      name: web
      start_ip: 10.1.0.11

</code></pre>

<p>Now that we have defined our infrastructure we are ready to apply our definition:</p>

<pre><code>$ ernest service apply demo1.yml
Environment creation requested
Ernest will show you all output from your requested service creation
You can cancel at any moment with Ctrl+C, even the service is still being created, you won't have any output
Starting environment creation

Creating routers:
  195.3.186.42
Routers successfully created

Creating networks:
  - 10.1.0.0/24
Networks successfully created

Creating instances:
   - r3-jreid2-demo1-web-1
Instances successfully created

Updating instances:
   - r3-jreid2-demo1-web-1
Instances successfully updated

Setting up firewalls:
Firewalls Created

Configuring nats
Nats Created

SUCCESS: rules successfully applied
Your environment endpoint is: 195.3.186.42

</code></pre>

<p>Congratulations! You have built your first infrastructure with Ernest. You can now SSH to the server on IP 195.3.186.42 to install and configure your software.</p>

<p>If you wish to change the infrastructure update your YAML to show how you want the infrastructure to look, then re-apply the YAML. Ernest will make the appropriate changes to the infrastructure.</p>

<p>For example if we increase the &lsquo;web&rsquo; instance count from 1 to 2 and re-apply the YAML a new server is created:</p>

<pre><code>$ ernest service apply demo1.yml 
Environment creation requested
Ernest will show you all output from your requested service creation
You can cancel at any moment with Ctrl+C, even the service is still being created, you won't have any output
Starting environment creation

Creating instances:
   - r3-jreid2-demo1-web-2
Instances successfully created

Updating instances:
   - r3-jreid2-demo1-web-2
Instances successfully updated

SUCCESS: rules successfully applied
Your environment endpoint is: 195.3.186.42

</code></pre>

<p>We can list the services we created:</p>

<pre><code>$ ernest service list
NAME  UPDATED       STATUS  ENDPOINT
demo1 2016-05-29 14:52:13 +0100 BST done  195.3.186.42

</code></pre>

<p>For a given service we can see the history:</p>

<pre><code>$ ernest service history demo1
NAME  BUILD ID                UPDATED       STATUS
demo1 488249c2-63c2-484e-b6e0-c690ba859dab-8c22343f8f9d3dfb68e41cc033e7b492 2016-05-29 14:52:13 +0100 BST done
demo1 6799e858-0484-42cb-bbb1-c1bc5f61e500-8c22343f8f9d3dfb68e41cc033e7b492 2016-05-29 14:39:56 +0100 BST done

</code></pre>

<p>For a given service and build ID we can see the definition we applied:</p>

<pre><code>$ ernest service definition demo1 --build 488249c2-63c2-484e-b6e0-c690ba859dab-8c22343f8f9d3dfb68e41cc033e7b492
---
name: demo1
datacenter: r3-jreid2
bootstrapping: none
service_ip: 195.3.186.42

routers: 
  - name: test1
    rules:
    - name: in_out_any
      source: internal
      from_port: any
      destination: external
      to_port: any
      protocol: any
      action: allow

    - name: out_in_22
      source: any
      from_port: any
      destination: internal
      to_port: '22'
      protocol: tcp
      action: allow

    networks:
      - name: web
        subnet: 10.1.0.0/24
        dns:
          - 8.8.8.8
          - 8.8.4.4

    port_forwarding:
      - source: 195.3.186.42
        from_port: '22'
        to_port: '22'
        destination: 10.1.0.11

instances:
  - name: web
    image: r3/ubuntu-1404
    cpus: 1
    memory: 1GB
    count: 2
    networks:
      name: web
      start_ip: 10.1.0.11

</code></pre>

<h3 id="infrastructure-and-server-configuration">Infrastructure and Server Configuration</h3>

<p>In the above example the task of installing and configuring software was left to the user to do. In this example we will bootstrap the servers and install our software directly from the YAML.</p>

<p>The new YAML is shown here:</p>

<pre><code>---
name: demo2
datacenter: r3-jreid2
bootstrapping: salt
service_ip: 195.3.186.42
ernest_ip:
  - 31.210.241.221
  - 31.210.240.161

routers: 
  - name: test1
    rules:
    - name: in_out_any
      source: internal
      from_port: any
      destination: external
      to_port: any
      protocol: any
      action: allow

    - name: out_in_80
      source: any
      from_port: any
      destination: internal
      to_port: '80'
      protocol: tcp
      action: allow

    networks:
      - name: web
        subnet: 10.1.0.0/24
        dns:
          - 8.8.8.8
          - 8.8.4.4
          
    port_forwarding:
      - source: 195.3.186.42
        from_port: '80'
        to_port: '80'
        destination: 10.1.0.11

instances:
  - name: web
    image: r3/ubuntu-1404
    cpus: 1
    memory: 1GB
    count: 1
    networks:
      name: web
      start_ip: 10.1.0.11
    provisioner:
      - exec:
        - 'sudo apt-get update'
        - 'sudo apt-get install apache2 -y'

</code></pre>

<p>The first thing to notice is that we have changed &lsquo;bootstrapping&rsquo; from &lsquo;none&rsquo; to &lsquo;salt&rsquo;. This will result in Ernest deploying a SALT instance that we can use to manage our environment. Note that the &lsquo;bootstrapping&rsquo; option must be specified when an environment is created and cannot be changed for that environment.</p>

<p>The next thing we have changed are the firewall and port-forwarding configuration. We have removed the sections needed for SSH access to the server since we are now able to run commands directly from the YAML.</p>

<p>Finally, we have added a provisioner section to the instance that will install the Apache HTTP Server.</p>

<p>Now that we have defined our platform we are ready to create it:</p>

<pre><code>$ ernest service apply demo2.yml
Environment creation requested
Ernest will show you all output from your requested service creation
You can cancel at any moment with Ctrl+C, even the service is still being created, you won't have any output
Starting environment creation

Creating routers:
  195.3.186.42
Routers successfully created

Creating networks:
  - 10.254.254.0/24
  - 10.1.0.0/24
Networks successfully created

Creating instances:
   - r3-jreid2-demo2-salt-master
   - r3-jreid2-demo2-web-1
Instances successfully created

Updating instances:
   - r3-jreid2-demo2-salt-master
   - r3-jreid2-demo2-web-1
Instances successfully updated

Setting up firewalls:
Firewalls Created

Configuring nats
Nats Created

Bootstrapping
Instances bootstrapped

Running executions
Executions ran

SUCCESS: rules successfully applied
Your environment endpoint is: 195.3.186.42

</code></pre>

<p>Notice that Ernest has automatically created a SALT instance for us on network 10.254.254.0/24. It has also trigged the bootstrapping process that installs the SALT minion on each of our servers, and then run the commands we specified in the provisioner section of each instance defined in the YAML.</p>

<p>You should be able to browse to <a href="http://195.3.186.42" target="_blank">http://195.3.186.42</a>. Congratulations!</p>

<p>If you wish to change the platform update your YAML to show how you want the platform to look, then re-apply the YAML. Ernest will make the appropriate changes to the platform.</p>

<blockquote>
<p>The SALT image can be downloaded from <a href="/downloads/r3-salt-master.ova">here</a>. For the current version of Ernest (1.0) it is not possible to specify the catalog name that Ernest will get the SALT image from, you will need to place the image in a catalog named &lsquo;r3&rsquo;.</p>
</blockquote>

<h3 id="servers-only">Servers Only</h3>

<p>If your vCloud account does not have the Organization Administrator assigned to it most of the network related configuration in the above examples will be impossible. You will be limited to the creation and modification of virtual machines only. An example YAML for this scenario is:</p>

<pre><code>---
name: demo3
datacenter: r3-jreid2

instances:
  - name: web
    image: r3/ubuntu-1404
    cpus: 1
    memory: 1GB
    count: 1
    networks:
      name: r3-jreid2-test3-web
      start_ip: 10.1.0.11

</code></pre>

<p>And applying it gives:</p>

<pre><code>$ ernest service apply demo3.yml
Environment creation requested
Ernest will show you all output from your requested service creation
You can cancel at any moment with Ctrl+C, even the service is still being created, you won't have any output
Starting environment creation

Creating instances:
   - r3-jreid2-demo3-web-1
Instances successfully created

Updating instances:
   - r3-jreid2-demo3-web-1
Instances successfully updated

SUCCESS: rules successfully applied
Your environment endpoint is: 

</code></pre>

<h2 id="next-steps">Next Steps</h2>

<p>Take a look at the <a href="/documentation/vcloud-enhanced/">enhanced examples</a>.</p>

    </div>
  </div>
</div>
      <footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-6 footer-left">
          <h3>A project by <a href="http://r3labs.io" target="blank">R3 Labs</a></h3>
        </div>
        <div class="col-xs-6 footer-right">
          <h3>
            <a href="https://twitter.com/r3labs" target="_blank"><i class="fa fa-twitter"></i></a>
            <a href="/slack"><i class="fa fa-slack"></i></a>
            <a href="https://github.com/ernestio" target="_blank"><i class="fa fa-github"></i></a>
            <a href="https://groups.google.com/forum/#!forum/ernestio" target="_blank"><i class="fa fa-google"></i></a>
            <a href="https://www.facebook.com/r3labsio/" target="_blank"><i class="fa fa-facebook"></i></a>
          </h3>
        </div>
    </div>
  </div>
</footer>

    

<script src="//s3.amazonaws.com/mailmunch/static/site.js" id="mailmunch-script" data-mailmunch-site-id="" async="async"></script>





<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script src="/js/popover/angular-storage.min.js"></script>


<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//shortname.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.configure({ languages: [] });</script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','Your Google Analytics tracking code'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false ; 
var EXPIRE_COOKIE =  5 ; 
var SHOW_MODAL_TIMEOUT =  10000 ; 
var MOUSE_LEAVE =  true ; 
var MODAL_SIZE = ""; 
var POST_URL = "https://zapier.com/hooks/catch/1227563/"; 
var SIGNUP_HEADER = "Join Our Newsletter";
var HEADER_IMAGE = "//placehold.it/1000x600";
var IMG_DESCRIPTION = "Placeholder image for this popover modal optin form";
var SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.";
var INPUT_PLACEHOLDER = "Enter your email";
var SUBMIT_BUTTON = "Subscribe";
var SUCCESS_MESSAGE = "Thanks for your subscription!";
var ERROR_MESSAGE = "Submitting form failed!";
var OPTIN =  true ;
var COOKIE_NAME = "mycookie1";
</script>
<script src="/js/popover/angular-modal-service.min.js"></script>
<script src="/js/angular-ismobile.min.js"></script>
<script src="/js/popover/popover.min.js"></script>

  </body>
</html>

